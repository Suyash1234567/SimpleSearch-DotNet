@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers;

@Html.Partial("_PartialView");
@{
    ViewData["Title"] = "Index";
}

<h2>Movie List</h2>


<form method="post" id="Movielist">
    <div class="form-group">
        <label for="input">Search a movie by its ID:</label>
        <input type="text" name="Search">
    </div>
</form>

<input type="button" value="Submit" class="btn btn-default" data-attr="submit"></input>

<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
<link href="//cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="//cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css" rel="stylesheet" />
<script>
    $('[data-attr="submit"]').on('click', function () {
        $.ajax(
            {
                url: "/Movie/Index",
                type: "POST",
                data: $('#MovieList').serialize(),
                success: function (response) {
                    var tr;
                    console.log(response);
                    for (var i = 0; i < response.length; i++) {
                        tr = tr + "<tr>";
                        tr = tr + "<td>" + response[i].MovieId + "</td>";
                        tr = tr + "<td>" + response[i].MovieName + "</td>";
                        tr = tr + "<td>" + response[i].ReleaseYear + "</td>";
                        tr = tr + "<td>" + response[i].Genre + "</td>";
                        tr = tr + "</tr>";
                    }
                    $('#MovieList').append(tr);
                    tblFormate();
                },
                error: function (err) {
                    console.log(err);
                }
            });

        function tblFormate() {
            <script src="//code.jquery.com/jquery-1.12.3.js"></script>
            <script src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>

            // Convert normal table to Ajax table with default design
            var table = $('#MovieList').DataTable(
                {
                    "lengthMenu": [[5, 10, 50, 100, 150, -1], [5, 10, 50, 100, 150, "All"]]
                });
            //Each column seach based on columns
            table.columns().eq(0).each(function (colIdx) {
                $('input', table.column(colIdx).header()).on('keyup change', function () {
                    table
                        .column(colIdx)
                        .search(this.value)
                        .draw();
                });
            });
        }


    });
</script>